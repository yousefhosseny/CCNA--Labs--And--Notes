### مقدمة عن OSPF
ال OSPF (Open Shortest Path First) هو بروتوكول توجيه يعتمد على "حالة الوصلة" (link-state)، يعني ده إنه يراقب حالة الروابط بين الراوترات بدل ما يعتمد على مسافات بسيطة زي بروتوكول RIP (اللي هو distance vector). فائدته الرئيسية: يشتغل أسرع في التحديثات (convergence) ويقدر يتعامل مع شبكات كبيرة جداً بدون مشاكل.

- **المناطق (Areas)**: OSPF يقسم الشبكة إلى مناطق صغيرة عشان يقلل من حركة التحديثات اللي بتنتشر في الشبكة كلها. كل منطقة لها حدود، وده يساعد في التحكم.
- **الروابط (Links)**: ده يعني واجهات الراوتر، أو الشبكات اللي تربط بين راوترين، أو حتى شبكة محلية زي Ethernet متصلة براوتر واحد.
- **حالة الرابط (Link-State)**: معلومات عن الرابط زي عنوان الشبكة، طول البادئة (prefix length)، والتكلفة (cost).
- التركيز هنا على OSPF في منطقة واحدة (single-area)، مش المتعدد.

### مكونات OSPF
كل بروتوكولات التوجيه لها أجزاء مشتركة: رسائل لتبادل المعلومات، هيكل بيانات، وخوارزمية لحساب الطرق.

- **الرسائل (Packets)**: OSPF يستخدم 5 أنواع حزم عشان يتبادل معلومات:
  - Hello: عشان يكتشف الجيران (الراوترات القريبة).
  - Database Description (DBD): وصف قاعدة البيانات.
  - Link-State Request: طلب معلومات عن روابط معينة.
  - Link-State Update: تحديث معلومات الروابط.
  - Link-State Acknowledgment: تأكيد استلام التحديثات.

- **قواعد البيانات (Databases)**:
  | قاعدة البيانات | اسم آخر | وصف بسيط |
  |-----------------|---------|----------|
  | الAdjacency Database | Neighbor Table | قائمة بالجيران اللي الراوتر متصل معاهم بشكل ثنائي (bi-directional). خاصة بكل راوتر. شوفها بأمر `show ip ospf neighbor`. |
  | ال Link-State Database (LSDB) | Topology Table | معلومات عن كل الراوترات في الشبكة، تمثل خريطة الشبكة كلها. كل الراوترات في المنطقة الواحدة لها نفس LSDB. شوفها بأمر `show ip ospf database`. |
  | ال Forwarding Database | Routing Table | الطرق النهائية بعد حساب الخوارزمية. خاصة بكل راوتر، تقول إزاي ترسل البيانات. شوفها بأمر `show ip route`. |

- **الخوارزمية**: OSPF يستخدم Dijkstra's SPF (Shortest Path First) عشان يحسب أقصر طريق بناءً على التكلفة التراكمية. يبني شجرة SPF مع الراوتر نفسه في الجذر، ثم يحسب أفضل الطرق ويحطها في جدول التوجيه.

![[Pasted image 20260106034149.png]]

### عملية التوجيه في OSPF (Link-State Operation)
الراوترات في OSPF تمر بخطوات بسيطة عشان توصل لـ "التوافق" (convergence)، يعني كلهم يعرفوا الشبكة كلها:

1. **إقامة الجوار (Establish Neighbor Adjacencies)**: الراوترات تكتشف بعضها عبر Hello packets وتتأكد إن الاتصال ثنائي.
2. **تبادل إعلانات حالة الروابط (Exchange Link-State Advertisements - LSAs)**: يرسلوا معلومات عن روابطهم.
3. **بناء قاعدة البيانات LSDB**: كل راوتر يجمع المعلومات دي في جدول.
4. **تنفيذ SPF**: يحسب أقصر الطرق باستخدام الخوارزمية.
5. **اختيار أفضل طريق (Choose the Best Route)**: يحط الطرق في جدول التوجيه.

### OSPF في منطقة واحدة مقابل متعددة
- ال**Single-Area OSPF**: كل الراوترات في منطقة واحدة (يفضل تسميتها Area 0). بسيط، لكن لو الشبكة كبيرة، التحديثات بتنتشر كلها.
- ال**Multiarea OSPF**: تقسيم الشبكة إلى مناطق متعددة، كلها متصلة بالمنطقة الرئيسية (Backbone Area 0). الراوترات اللي تربط المناطق تسمى ABRs (Area Border Routers).

فوائد المتعدد:
- جداول توجيه أصغر (يمكن تلخيص العناوين).
- أقل حمل على الراوترات (أقل معالجة وذاكرة).
- تغييرات الشبكة تبقى محلية في المنطقة، مش تنتشر كلها.

Single-Area OSPF
![[Pasted image 20260106034212.png]]


Multiarea OSPF
![[Pasted image 20260106034248.png]]

### OSPFv3
ده نسخة OSPF لـ IPv6 (بدل IPv4). يعمل زي OSPFv2، لكن يتبادل عناوين IPv6 ويستخدم SPF نفسه. العمليات مستقلة عن IPv4، لكن الوظائف مشابهة.

باختصار، OSPF زي خريطة ذكية للشبكة: يعرف حالة كل رابط، يحسب أقصر طريق، ويقدر يقسم الشبكة عشان تبقى أسرع وأكثر كفاءة. لو عايز تفاصيل أكتر عن جزء معين، قل!
